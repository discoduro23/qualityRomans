<html>
  <head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FZVNP8MQCV"></script>
<script  src="romans.js"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FZVNP8MQCV');

 
// Now the convertion methods receive both an input argument instead
// of reading directly from the UI.
// On top of that, they return a JSON object instead of updating the
// UI directly. The JSON object contains the result (ok/nok), the value
// and an error message if needed
const convertRomanToInteger = function(roman) {

var response = {
  value: 0, 
  message: '',
  result: false 
};

// Regexp to check if a string is a valid roman number
const romanNumeralRegex = new RegExp(
  /^M{0,3}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3})$/
);

// Convert the string to uppercase so we just to handle uppercase strings
roman = roman.toUpperCase();
const regexResult = romanNumeralRegex.test(roman);

// Either the string is not a valid roman number or is empty
if (!regexResult || roman.length <= 0) {
  response.message = INVALID_ROMAN;
  return response;
}

var arr = ['I', 'V', 'X', 'L', 'C', 'D', 'M'];

var values = {
  I: 1,
  V: 5,
  X: 10,
  L: 50,
  C: 100,
  D: 500,
  M: 1000,
};

var sum = 0;

var prevIndex = 0;

for (var i = roman.length - 1; i >= 0; i--) {
  if (arr.indexOf(roman[i]) >= prevIndex) {
    sum = sum + values[roman[i]];
  } else {
    sum = sum - values[roman[i]];
  }

  prevIndex = arr.indexOf(roman[i]);
}

response.value = sum;
response.result = true;

gtag('event', 'convert_to_int_value', {
        'value' : response.value
        });

gtag('event', 'convert_to_int_count', {
        'intUsed' : true
        });

return response;
};

// Now the convertion methods receive both an input argument instead
// of reading directly from the UI.
// On top of that, they return a JSON object instead of updating the
// UI directly. The JSON object contains the result (ok/nok), the value
// and an error message if needed
const convertIntegerToRoman = function(num) {

var response = {
  value: 0,
  message: '', 
  result: false 
};

// Regexp to check the input is a valid integer
const numberRegex = new RegExp(/^\d+$/);

const regexResult = numberRegex.test(num);

// Not an integer -> we exit with the appropriate message
if (!regexResult) {
  response.message = INVALID_INTEGER;
  return response;
}

// Integer not in the supported range -> exit with the right message
if (Number(num) > 3999 || Number(num) < 1) {
  response.message = OUT_OF_RANGE;
  return response;   
}

const mapping = {
  1: 'I',
  5: 'V',
  10: 'X',
  50: 'L',
  100: 'C',
  500: 'D',
  1000: 'M',
};

var count = 1;
var str = '';
while (num > 0) {
  var last = parseInt(num % 10);
  last *= count;
  if (last < 10) {
    str += lessThan9(last, mapping);
  } else {
    str = greaterThan9(last, mapping) + str;
  }

  count *= 10;
  num = parseInt(num / 10);
}

response.value = str;
response.result = true;

gtag('event', 'convert_to_roman_value', {
        'value' : response.value
        });

gtag('event', 'convert_to_roman_count', {
        'romanUsed' : true
        });

return response;
};

</script>
    <link rel="stylesheet" href="romans.css">
  </head>
  <body onload="init()">
    <main class="container">
      <section class="content">
        <h1>Roman To Integer</h1>
        <div class="group">
          <input type="checkbox" name="mode-selector" />
          <label for="mode-selector">Change Mode</label>
        </div>
        <div class="group">
          <input type="text" name="conversion-input" />
        </div>
        <span class="convert-button">Convert</span>
        <p class="convert-output"></p>
      </section>
    </main>
  </body>
</html>